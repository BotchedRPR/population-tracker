<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zegary Ludności</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        .counter-container {
            text-align: center;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin: 10px;
            width: 300px;
        }
        h1 {
            margin: 0;
            font-size: 20px;
            color: #333;
        }
        .counter {
            font-size: 32px;
            color: #007BFF;
            margin: 20px 0;
            position: relative;
            height: 40px; /* Stała wysokość, aby liczby nie zmieniały układu */
            overflow: hidden;
        }
        .digit {
            position: absolute;
            left: 0;
            right: 0;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        .digit.show {
            opacity: 1;
            transform: translateY(0);
        }
        .digit.hide {
            opacity: 0;
            transform: translateY(-20px);
        }
        p {
            margin: 0;
            font-size: 14px;
            color: #555;
        }
        .timer {
            font-size: 20px;
            color: #FF5733;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Zegary Ludności</h1>
    <div id="counters-container"></div>
    
    <script>
        const counters = [
            {
                id: "koscierzyna",
                name: "Kościerzyna",
                startPopulation: 23353,
                startDate: new Date("2024-06-01T00:00:00"),
                births: 98,
                deaths: 130
            },
            {
                id: "powiat-koscierzynski",
                name: "Powiat Kościerski",
                startPopulation: 72201,
                startDate: new Date("2024-06-01T00:00:00"),
                births: 309,
                deaths: 361
            },
            {
                id: "wojewodztwo-pomorskie",
                name: "Województwo Pomorskie",
                startPopulation: 2359956,
                startDate: new Date("2024-06-01T00:00:00"),
                births: 8893,
                deaths: 11643
            },
            {
                id: "polska",
                name: "Polska",
                startPopulation: 37563071,
                startDate: new Date("2024-06-01T00:00:00"),
                births: 125637,
                deaths: 20336
            }
        ];

        const secondsInHalfYear = 181 * 24 * 3600;

        function createCounter(counter) {
            const birthInterval = secondsInHalfYear / counter.births;
            const deathInterval = secondsInHalfYear / counter.deaths;
            let firstUpdate = true; // Flaga dla pierwszej aktualizacji

            function calculatePopulation() {
                const now = new Date();
                const elapsedSeconds = Math.floor((now - counter.startDate) / 1000);

                const births = Math.floor(elapsedSeconds / birthInterval);
                const deaths = Math.floor(elapsedSeconds / deathInterval);

                return counter.startPopulation + births - deaths;
            }

            function calculateNextEvent() {
                const now = new Date();
                const elapsedSeconds = Math.floor((now - counter.startDate) / 1000);

                const nextBirthIn = birthInterval - (elapsedSeconds % birthInterval);
                const nextDeathIn = deathInterval - (elapsedSeconds % deathInterval);

                return { nextBirthIn, nextDeathIn };
            }

            function updateDisplay() {
                const populationElement = document.getElementById(`${counter.id}-population`);
                const newPopulation = calculatePopulation();

                if (firstUpdate) {
                    // Ustaw natychmiastowo wartość na bieżący stan
                    setPopulation(populationElement, newPopulation, true);
                    firstUpdate = false;
                } else {
                    // Płynna animacja zmiany
                    const currentPopulation = parseInt(
                        populationElement.querySelector(".digit.show").textContent.replace(/\s+/g, '')
                    );
                    if (currentPopulation !== newPopulation) {
                        setPopulation(populationElement, newPopulation, false);
                    }
                }

                const { nextBirthIn, nextDeathIn } = calculateNextEvent();
                const nextEventText =
                    nextBirthIn <= nextDeathIn
                        ? `Za ${formatTime(nextBirthIn)} nastąpi urodzenie`
                        : `Za ${formatTime(nextDeathIn)} nastąpi zgon`;

                document.getElementById(`${counter.id}-next-event`).textContent = nextEventText;
            }

            function setPopulation(element, newPopulation, instant) {
                const newDigitElement = document.createElement("div");
                newDigitElement.classList.add("digit");
                if (!instant) {
                    newDigitElement.classList.add("show");
                }
                newDigitElement.textContent = newPopulation.toLocaleString("pl-PL");

                const currentDigit = element.querySelector(".digit.show");
                if (currentDigit) {
                    currentDigit.classList.remove("show");
                    currentDigit.classList.add("hide");
                    // Usuń po zakończeniu animacji
                    setTimeout(() => currentDigit.remove(), 500);
                }

                element.appendChild(newDigitElement);

                if (instant) {
                    newDigitElement.classList.add("show");
                } else {
                    setTimeout(() => newDigitElement.classList.add("show"), 10);
                }
            }

            function formatTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const sec = Math.floor(seconds % 60);
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            }

            const container = document.createElement("div");
            container.classList.add("counter-container");
            container.innerHTML = `
                <h1>${counter.name}</h1>
                <div class="counter" id="${counter.id}-population">
                    <div class="digit show">${counter.startPopulation.toLocaleString("pl-PL")}</div>
                </div>
                <p id="${counter.id}-next-event">Czas do zmiany: --:--:--</p>
            `;
            document.getElementById("counters-container").appendChild(container);

            // Natychmiastowa aktualizacja po załadowaniu strony
            updateDisplay();

            // Regularne aktualizacje co sekundę
            setInterval(updateDisplay, 1000);
        }

        counters.forEach(createCounter);
    </script>
</body>
</html>
